<!DOCTYPE html>
<html>
<head>
    <title>Metryki</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/png" href="/static/icons/icon-512.png">
    <link rel="apple-touch-icon" href="/static/icons/icon-512.png">
    <link rel="stylesheet" href="/static/css/main.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-row">
                <h1>ğŸ“Š Metryki</h1>
                <span class="pill">Zakres: {{ range_days }} dni</span>
            </div>
            <div class="header-actions">
                <a class="btn btn-outline" href="/">Panel</a>
                <a class="btn btn-outline" href="/profile">Profil</a>
                <a class="btn btn-outline" href="/plans">Plany siÅ‚owe</a>
                <a class="btn btn-outline" href="/logout">Wyloguj</a>
            </div>
        </header>

        <div class="card">
            <div class="range-row">
                <div class="metrics-range-label">ğŸ“Š Metryki (ostatnie {{ range_days }} dni)</div>
                <div class="range-btns">
                    <a class="btn btn-soft btn-small" href="/metrics?days=7">7</a>
                    <a class="btn btn-soft btn-small" href="/metrics?days=30">30</a>
                    <a class="btn btn-soft btn-small" href="/metrics?days=90">90</a>
                    <a class="btn btn-soft btn-small" href="/metrics?days=365">365</a>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card run">
                    <span class="stat-icon">ğŸƒ</span>
                    <div class="stat-val">{{ stats.run_count }}</div>
                    <div class="stat-sub">{{ stats.run_dist }} km</div>
                    <div class="stat-label">Bieganie</div>
                </div>

                <div class="stat-card swim">
                    <span class="stat-icon">ğŸŠ</span>
                    <div class="stat-val">{{ stats.swim_count }}</div>
                    <div class="stat-sub">{{ stats.swim_dist }} km</div>
                    <div class="stat-label">Basen</div>
                </div>

                <div class="stat-card gym">
                    <span class="stat-icon">ğŸ‹ï¸</span>
                    <div class="stat-val">{{ stats.gym_count }}</div>
                    <div class="stat-sub">{{ stats.gym_hours }} h</div>
                    <div class="stat-label">SiÅ‚ownia</div>
                </div>

                <div class="stat-card ride">
                    <span class="stat-icon">ğŸš´</span>
                    <div class="stat-val">{{ stats.ride_count }}</div>
                    <div class="stat-sub">{{ stats.ride_dist }} km</div>
                    <div class="stat-label">Rower</div>
                </div>
            </div>

            <div class="charts-container">
                <div class="chart-card">
                    <div class="chart-title">ğŸ¯ PostÄ™p (prosty cel biegowy tygodnia)</div>
                    <div class="goal-row">
                        <div class="goal-chart">
                            <canvas id="runGoalChart"></canvas>
                            <div class="goal-center">
                                <div class="goal-count">
                                    {{ stats.run_count }} / 3
                                </div>
                                <div class="goal-label">TRENINGI</div>
                            </div>
                        </div>
                        <div class="goal-meta">
                            <p><b>Cel:</b> 3 treningi</p>
                            <p class="goal-sub">Wykonano: {{ stats.run_count }}</p>
                            <p class="goal-remaining">
                                {% if (stats.run_count) >= 3 %}Cel osiÄ…gniÄ™ty! ğŸ‰
                                {% else %}ZostaÅ‚o: {{ 3 - stats.run_count }}{% endif %}
                            </p>
                        </div>
                    </div>
                </div>

                <div class="chart-card">
                    <div class="chart-title">â±ï¸ AktywnoÅ›ci (liczba)</div>
                    <div class="chart-fixed">
                        <canvas id="timeChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% include "_chat_widget.html" %}

    <script>
    const runCount = {{ stats.run_count }};
    const runTarget = 3;
    const remaining = Math.max(0, runTarget - runCount);

    const ctxGoal = document.getElementById('runGoalChart').getContext('2d');
    new Chart(ctxGoal, {
        type: 'doughnut',
        data: {
            labels: ['Zrobione', 'Do zrobienia'],
            datasets: [{
                data: [runCount, remaining],
                backgroundColor: ['#00bf63', '#eeeeee'],
                borderWidth: 0,
                borderRadius: 10
            }]
        },
        options: { cutout: '80%', plugins: { legend: { display: false }, tooltip: { enabled: false } }, maintainAspectRatio: false }
    });

    const ctxTime = document.getElementById('timeChart').getContext('2d');
    new Chart(ctxTime, {
        type: 'doughnut',
        data: {
            labels: ['Bieg', 'Basen', 'SiÅ‚ownia', 'Rower'],
            datasets: [{
                data: [{{ stats.run_count }}, {{ stats.swim_count }}, {{ stats.gym_count }}, {{ stats.ride_count }}],
                backgroundColor: ['#00bf63', '#00a8cc', '#8e44ad', '#ff5722'],
                borderWidth: 0
            }]
        },
        options: { plugins: { legend: { position: 'right', labels: { boxWidth: 10, font: {size: 10} } } }, maintainAspectRatio: false }
    });
    </script>
</body>
</html>
